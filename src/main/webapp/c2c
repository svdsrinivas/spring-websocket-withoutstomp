travel-us-cartPage-c2c
const  {Bootstrapper,window,document,lpChatGlobalDiv,omn_hierarchy,omn_pagename,omn}=require('./_mocks_/mock-travel_us_cartPage-c2c')

try{
    var hostName=window.location.hostname;
    var pageNameflag = false;
    var omnPageName = "";
    var omnHierarchy = "";
    var lpPageName = "";
    var omnintercheck = "";
    var customerType = "standard";
    var delayCounterCart = 0;
    var lpTagFile = "";
    var sessionCookie = Bootstrapper.readCookie("amexsessioncookie");
    if(typeof(Bootstrapper.ensEnv) !== "undefined" && Bootstrapper.ensEnv == "2"){
        lpTagFile = "//qwww.aexp-static.com/api/axpi/ensighten/liveengage-lp/le-mtagconfig.js";
    }else{
        lpTagFile = "//www.aexp-static.com/api/axpi/ensighten/liveengage-lp/le-mtagconfig.js";
    }
    window.lpTag = window.lpTag || {};
    window.lpTag.vars = window.lpTag.vars || [];
    window.lpTag.dbs = window.lpTag.dbs || [];
    window.lpMTagConfig = window.lpMTagConfig || {};
    window.lpTag.sdes = window.lpTag.sdes||[];
    window.lpTag.section = 'us travel en';
    window.lpTag.tagletSection = 'travel';

    Bootstrapper.insertScript("//www.aexp-static.com/api/axpi/ioa/js/iOAjquery1.6.3.min.js"); // Required for Vendor hosted pages

    checkOmnVariables = function(){
        if(typeof omn_hierarchy === "string" || typeof omn === "object"){
            callLpCode();
        } else{
            delayCounterCart++;
            if (delayCounterCart <= 50) {
                setTimeout(function(){checkOmnVariables();}, 100);
            }
        }
    };

    callLpCode = function() {
        try{
//Load Lp chat button styles
           /* var fileHref = "https://icm.aexp-static.com/Internet/SMC/images/Chat/styles.css";
            var LPCSS = document.createElement("link");
            LPCSS.setAttribute("rel", "stylesheet");
            LPCSS.setAttribute("type", "text/css");
            LPCSS.setAttribute("href", fileHref);
            document.getElementsByTagName("head")[0].appendChild(LPCSS);*/
//Inject div for injecting LP chat button

            document.body.appendChild(lpChatGlobalDiv);

            if(typeof(omn_pagename) !== "undefined"){
                omnPageName = omn_pagename;
            } else if(typeof(omn) !== "undefined" && typeof(omn.pagename) !== "undefined"){
                omnPageName = omn.pagename;
            } else if(typeof(s) !== "undefined" && typeof(s.pageName) !== "undefined"){
                omnPageName = s.pageName;
            } else {
                omnPageName = "NotAvailble";
            }

            if(typeof(omn_hierarchy) !== "undefined"){
                omnHierarchy = omn_hierarchy;
            } else if(typeof(omn) !== "undefined" && typeof(omn.hierarchy) !== "undefined"){
                omnHierarchy = omn.hierarchy;
            }else{
                omnHierarchy = "NotAvailble";
            }
            if(omnPageName === "NotAvailble"){
                lpPageName = omnHierarchy+"|"+omnPageName;
            } else {
                lpPageName = omnPageName;
            }

            if(typeof lpPageName !== "" ){
                if(lpPageName.indexOf("Platinum")>-1 && sessionCookie!==null){
                    customerType="platinum";
                }
            }
//send omn data to LP system
            lpTag.section = "US-Travel-sales";
            if(typeof lpTag.sdes === "object"){
                lpTag.sdes.push(
                    {
                        "type": "service",
                        "service": {
                            "topic": lpPageName
                        },
                        "type": "ctmrinfo",
                        "info": {
                            "ctype": customerType
                        }
                    }
                );
            }

//var inavlog = typeof(iNavUserLoggedIn) !== "undefined" && iNavUserLoggedIn === true;
//console.log("inavlogvariable::"+inavlog);
//Load lp mTag file
            Bootstrapper.insertScript(lpTagFile);
        }catch(err){}
    };

    if (typeof(omn_pagename) === "undefined" || typeof(omn) === "undefined") {
        checkOmnVariables();
    } else{
        callLpCode();
    }

    omnvarupdate=function(){
        try{
            if(typeof(omn) !== "undefined" && typeof(omn.pagename) !== "undefined"){
                omnPageName = omn.pagename;
                pageNameflag = false;
            }
            else if(typeof(omn_pagename) !== "undefined"){
                omnPageName = omn_pagename;
                pageNameflag = false;
            }else if(typeof(s) !=="undefined" && typeof(s.pageName) !== "undefined"){
                omnPageName = s.pageName;
                pageNameflag = true;
            } else {
                omnPageName = "NotAvailble";
            }
            if(typeof(omn) !== "undefined" && typeof(omn.hierarchy) !== "undefined"){
                omnHierarchy = omn.hierarchy;
            }else if(typeof(omn_hierarchy) !== "undefined"){
                omnHierarchy = omn_hierarchy;
            } else {
                omnHierarchy = "NotAvailble";
            }

            if(omnPageName === "NotAvailble"){
                lpPageName = omnHierarchy+"|"+omnPageName;
            } else {
                lpPageName = omnPageName;
            }
// Send data to Lp system
            if(typeof lpTag.sdes === "object"){
                lpTag.sdes.push(
                    {
                        "type": "service",
                        "service": {
                            "topic": lpPageName
                        },
                        "type": "ctmrinfo",
                        "info": {
                            "ctype": customerType
                        }
                    }
                );
            }
        }catch(err){}
    };
    addlistenrstobuttons = function(button_idname,idxnum) {
        try{
            function addlistenrs(button_idname,idxnum){
                var id = document.querySelectorAll(button_idname)[idxnum];
                if(id !== undefined && id !== null && id !== ""){
                    Bootstrapper.unobtrusiveAddEvent(id,"onclick",function(){
                        //console.log("button onclick::"+id);
                        window.setTimeout(function(){Bootstrapper.omnvarupdate();},3000);});
                }
            }
            if(idxnum === 5 && button_idname === ".button-edit._jq-accordion-edit"){
                for(var j=0;j<idxnum;j++){
                    // console.log("edit button::"+j);
                    addlistenrs(button_idname,j);
                }
            }else if(idxnum === 0){
                for(var i=0;i<button_idname.length;i++){
                    // console.log(button_idname[i]+"::save button::"+idxnum);
                    addlistenrs(button_idname[i],idxnum);
                }
            }else if(idxnum === 1){
                //console.log(button_idname+"::Payment save button::"+idxnum);
                addlistenrs(button_idname,idxnum);
            }
        }catch(err){}
    };
//Sending section level details to Lp from the Cart page
//Travel insurance - Information save button,Preferred seat - Insurance no save button,Preferred seat - Insurance Yes Enroll Agree button,
//Preferred seat - Insurance Yes Disagree button,Payment information - seat skip selection button,Payment information - seat selection save button
    var buttoninforArr=[".button-save._jq-submit-button","#trip_insurance_no_submit","#enroll","#do-not-enroll",".skip-seats._jq-noThanks",".save-link.seats-save._jq-seats-save"];
//All buttons
    var idxnumsArr=[0,1,5];
    Bootstrapper.addlistenrstobuttons(buttoninforArr,idxnumsArr[0]);
//All edit button
    Bootstrapper.addlistenrstobuttons(".button-edit._jq-accordion-edit",idxnumsArr[2]);
//Booking - Payment - Pay with points/user your cards - save button
    Bootstrapper.addlistenrstobuttons(".button-save.clear._jq-submit-button",idxnumsArr[1]);

}catch(err){}

module.exports={checkOmnVariables,callLpCode,addlistenrstobuttons,omnvarupdate};

=============================================

const {checkOmnVariables,callLpCode,addlistenrstobuttons,omnvarupdate} =require('../models/travel-us-cartPage-c2c')
const  {Bootstrapper, document, window,navigator,$iOA,clearInterval,omn_hierarchy}=require('../models/_mocks_/mock-travel_us_cartPage-c2c')

describe('travel us cartPage c2c', () => {
    describe('travel us cartPage', () => {
        test('travel us cartPage',() => {
            expect(checkOmnVariables()).toBeUndefined();
        });
        test('travel us cartPage',() => {
            expect(callLpCode()).toBeUndefined();
        });
        test('travel us cartPage',() => {
            expect(addlistenrstobuttons()).toBeUndefined();
        });
        test('travel us cartPage',() => {
            expect(omnvarupdate()).toBeUndefined();
        });
    })
})


===========================================

const Bootstrapper={
    ensMarket:'en-US',
	ensEnv:"2",
    hostName:function(str,val){
       // console.log(window.location.hostname.indexOf(str,val))
        if(window.location.hostname.indexOf(str,val)==0){
           // console.log('yes')
            return true;
        }else{
          //  console.log('no')
            return false;
        }
        },
    insertScript:function(s){},
    readCookie:function(s){
        if(s=='amexsessioncookie'){
            return true;
        }else{
            return false;
        }
    },
    bindDOMParsed:function () { return true},
    bindPageSpecificCompletion:function () { return true}

    

}

clearInterval = function (interval) {

}
const document={body:{appendChild: function(s){return true}},createElement:function(s){return "<div></div>"},documentElement:{lang:"en_US"},location:{pathname:"/login"}}
const lpChatGlobalDiv = {setAttribute:function(){return true}}
const window={location:{href:"https://www.global.americanexpress.com/begin.do",pathname:"https://www.global.americanexpress.com/rewards.html",hostName:'rewards',hostname:'global.americanexpress.com',search:''},lpTag:{vars:[],newPage:'begin.do',sdes:[]},lpMTagConfig:{},site:undefined}
const navigator={userAgent:'aexphybrid'}
const $iOA = 'test';
const ioaVariableCheck='true';
const omn_pagename = "CartPage";
const omn_hierarchy = "US|Travel|Carts|CartPage";
const omn = {pagename: "CartPage", hierarchy :"US|Travel|Carts|CartPage"};
module.exports={Bootstrapper, document, window,navigator,$iOA,clearInterval,ioaVariableCheck,lpChatGlobalDiv,omn_hierarchy,omn_pagename,omn};
